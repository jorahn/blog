<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="twitter:card" content="summary_large_image" /><!-- Begin Jekyll SEO tag v2.6.1 -->
<title>Tackling Imbalanced Regression with SMOGN | Blog by Jonathan Rahn</title>
<meta name="generator" content="Jekyll v4.1.1" />
<meta property="og:title" content="Tackling Imbalanced Regression with SMOGN" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Initial Results with Synthetic Minority Over-Sampling Technique for Regression" />
<meta property="og:description" content="Initial Results with Synthetic Minority Over-Sampling Technique for Regression" />
<link rel="canonical" href="https://jorahn.github.io/blog/regression/imbalanced%20data/2021/08/24/Imbalanced_Regression.html" />
<meta property="og:url" content="https://jorahn.github.io/blog/regression/imbalanced%20data/2021/08/24/Imbalanced_Regression.html" />
<meta property="og:site_name" content="Blog by Jonathan Rahn" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2021-08-24T00:00:00-05:00" />
<script type="application/ld+json">
{"url":"https://jorahn.github.io/blog/regression/imbalanced%20data/2021/08/24/Imbalanced_Regression.html","@type":"BlogPosting","headline":"Tackling Imbalanced Regression with SMOGN","dateModified":"2021-08-24T00:00:00-05:00","datePublished":"2021-08-24T00:00:00-05:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://jorahn.github.io/blog/regression/imbalanced%20data/2021/08/24/Imbalanced_Regression.html"},"description":"Initial Results with Synthetic Minority Over-Sampling Technique for Regression","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/blog/assets/css/style.css"><link type="application/atom+xml" rel="alternate" href="https://jorahn.github.io/blog/feed.xml" title="Blog by Jonathan Rahn" /><!-- the google_analytics_id gets auto inserted from the config file -->



<!-- Google Tag Manager -->
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-PHGTT9K');</script>
<!-- End Google Tag Manager -->


<link rel="shortcut icon" type="image/x-icon" href="/blog/images/favicon.ico"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/Primer/15.2.0/primer.css" integrity="sha512-xTz2ys4coGAOz8vuV1NcQBkgVmKhsSEtjbqyMJbBHRplFuvKIUo6xhLHpAyPt9mfR6twHJgn9OgVLuqOvjeBhg==" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.14.0/css/all.min.css" integrity="sha512-1PKOgIY59xJ8Co8+NE6FZ+LOAZKjy+KY8iq0G4B3CyeY6wYHN3yt9PW0XpSriVlkMXe40PTKnXrLnZ9+fkDaog==" crossorigin="anonymous" />

<script>
function wrap_img(fn) {
    if (document.attachEvent ? document.readyState === "complete" : document.readyState !== "loading") {
        var elements = document.querySelectorAll(".post img");
        Array.prototype.forEach.call(elements, function(el, i) {
            if (el.getAttribute("title") && (el.className != "emoji")) {
                const caption = document.createElement('figcaption');
                var node = document.createTextNode(el.getAttribute("title"));
                caption.appendChild(node);
                const wrapper = document.createElement('figure');
                wrapper.className = 'image';
                el.parentNode.insertBefore(wrapper, el);
                el.parentNode.removeChild(el);
                wrapper.appendChild(el);
                wrapper.appendChild(caption);
            }
        });
    } else { document.addEventListener('DOMContentLoaded', fn); }
}
window.onload = wrap_img;
</script>

<script>
    document.addEventListener("DOMContentLoaded", function(){
    // add link icon to anchor tags
    var elem = document.querySelectorAll(".anchor-link")
    elem.forEach(e => (e.innerHTML = '<i class="fas fa-link fa-xs"></i>'));
    });
</script>
</head>
<body><header class="site-header">

  <div class="wrapper"><a class="site-title" rel="author" href="/blog/">Blog by Jonathan Rahn</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/blog/about/">About Me</a><a class="page-link" href="/blog/search/">Search</a><a class="page-link" href="/blog/categories/">Tags</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">Tackling Imbalanced Regression with SMOGN</h1><p class="page-description">Initial Results with Synthetic Minority Over-Sampling Technique for Regression</p><p class="post-meta post-meta-title"><time class="dt-published" datetime="2021-08-24T00:00:00-05:00" itemprop="datePublished">
        Aug 24, 2021
      </time>
       • <span class="read-time" title="Estimated read time">
    
    
      2 min read
    
</span></p>

    
      <p class="category-tags"><i class="fas fa-tags category-tags-icon"></i></i> 
      
        <a class="category-tags-link" href="/blog/categories/#Regression">Regression</a>
        &nbsp;
      
        <a class="category-tags-link" href="/blog/categories/#Imbalanced Data">Imbalanced Data</a>
        
      
      </p>
    

    </header>

  <div class="post-content e-content" itemprop="articleBody">
    <p>Imbalanced data is ubiquitous in practice and both research and high quality 
<a href="https://github.com/scikit-learn-contrib/imbalanced-learn">open source software</a>
exist for dealing with Imbalanced Classification tasks. Generally speaking, the main approaches 
are under-sampling observations from classes that are observed frequently or over-sampling
observations from rare classes to achieve a balanced distribution of labels. This can be 
done in naive ways (sampling with replacement) or in more sophisticated ways, e.g. by creating 
synthetic observations based on real observations with interpolations or added noise.</p>

<p>When working on a Regression problem with highly skewed target variable distribution, I’ve found
it much more difficult to come up with useful approaches vs. Classification. After some research, 
I have settled on three options to test individually and in combination:</p>
<ol>
  <li><a href="https://scikit-learn.org/stable/auto_examples/compose/plot_transformed_target.html">LogTransform</a> of the Target Variable</li>
  <li><a href="https://github.com/nickkunz/smogn">Synthetic Minority Over-Sampling Technique for Regression</a> - SMOGN</li>
  <li><a href="https://github.com/YyzHarry/imbalanced-regression">Deep Imbalanced Regression</a> - DIR</li>
</ol>

<p>LogTransform is in my standard toolbox and helped to boost performance as expected. But 
the imbalance/distribution was still skewed and far from normally distributed and thus 
predictions still centered in the range of most frequent observations. My Ridge, Gradient 
Boosting and FC-DNN models would completely ignore a significant range of (rare) target 
values in their predictions. Problem not solved!</p>

<p>Preprocessing the data with SMOGN took around 10 minuts and (applied in combination with LogTransform) lead to a 
slightly worse MAPE performance, but a much better coverage of the entire target value range. SMOGN provides 
roughly <a href="https://github.com/nickkunz/smogn/tree/master/examples">three stages</a>
of customization for the re-sampling process. I’d characterize these as automated, automated within bounds
and manual. So far I’ve tested the automated preprocessing and while I’m satisfied with the result,
the new distribution is multimodal and still not ideal for training. But I’m optimistic that
adding bounds or going for fully manual configuration of the re-sampling should lead to
further improvements. Problem still not solved, but a step in the right direction.</p>

<table>
  <thead>
    <tr>
      <th>Before</th>
      <th>After</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><img src="/blog/images/imbalanced_regression/skewed_target.png" alt="" title="Skewed Target Variable" /></td>
      <td><img src="/blog/images/imbalanced_regression/target_auto_smogn.png" alt="" title="Target Variable after auto SMOGN" /></td>
    </tr>
  </tbody>
</table>

<p>On my dataset, the total number of observations was reduced by ~20% after SMOGN upsampled rare observations
with noise and downsampled the frequent ones. Having taken care of all other preprocessing (missing data, numeric 
representations etc.), the number of columns was not affected. Missing values would have resulted in dropped 
columns. Lastly, I’ve compared a 2D PCA-plot of the original preprocessed dataset and the same dataset
after additional re-sampling with SMOGN and found the scatterplots to overlap very well.</p>

<p><img src="/blog/images/imbalanced_regression/pca_compare.png" alt="" title="PCA scatter plots" /></p>

<p>So far, I’ve not tried to apply DIR, as it seems a bit less straightforward, consisting of label smoothing
and feature smoothing as separate steps. Also the examples include integration into the PyTorch model and training loop. 
So this might not be applicable to the Ridge and Gradient Boosting models I keep running for comparison,
but a learning resampling instead of static one-off preprocessing, could yield even better results.</p>

  </div><a class="u-url" href="/blog/regression/imbalanced%20data/2021/08/24/Imbalanced_Regression.html" hidden></a>
</article>
      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/blog/"></data>

  <div class="wrapper">

    <div class="footer-col-wrapper">
      <div class="footer-col">
        <p class="feed-subscribe">
          <a href="/blog/feed.xml">
            <svg class="svg-icon orange">
              <use xlink:href="/blog/assets/minima-social-icons.svg#rss"></use>
            </svg><span>Subscribe</span>
          </a>
        </p>
      </div>
      <div class="footer-col">
        <p>Mostly tech &amp; data notes.</p>
      </div>
    </div>

    <div class="social-links"><ul class="social-media-list"><li><a rel="me" href="https://github.com/jorahn" title="jorahn"><svg class="svg-icon grey"><use xlink:href="/blog/assets/minima-social-icons.svg#github"></use></svg></a></li><li><a rel="me" href="https://twitter.com/rahnjonathan" title="rahnjonathan"><svg class="svg-icon grey"><use xlink:href="/blog/assets/minima-social-icons.svg#twitter"></use></svg></a></li></ul>
</div>

  </div>

</footer>
</body>

</html>
